# MCP å®‰è£…æœºåˆ¶åˆ†æ

## å®éªŒç»“æœæ€»ç»“

ç»è¿‡å®é™…æµ‹è¯•ï¼Œæˆ‘å‘ç°äº† MCP çš„çœŸå®å·¥ä½œæœºåˆ¶ï¼š

---

## å…³é”®å‘ç° ğŸ”

### 1. `claude mcp add` åªå†™é…ç½®ï¼Œä¸å®‰è£…åŒ…

```bash
# æ‰§è¡Œå‘½ä»¤
claude mcp add -s user filesystem -- npx -y @modelcontextprotocol/server-filesystem /tmp

# å®é™…æ•ˆæœ
âœ… å†™å…¥ ~/.claude.json
âŒ ä¸ä¼šæ‰§è¡Œ npm install
âŒ ä¸ä¼šä¸‹è½½ä¾èµ–
âŒ ä¸ä¼šå®‰è£…ç³»ç»Ÿåº“

# é…ç½®æ–‡ä»¶å†…å®¹
{
  "mcpServers": {
    "filesystem": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]
    }
  }
}
```

**ç»“è®ºï¼š**`claude mcp add` åªæ˜¯é…ç½®ç®¡ç†å‘½ä»¤ï¼Œä¸è´Ÿè´£ä¾èµ–å®‰è£…ï¼

---

### 2. `npx -y` ä¼šè‡ªåŠ¨ä¸‹è½½ npm åŒ…

```bash
# npx çš„ -y å‚æ•°å«ä¹‰ï¼šè‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„åŒ…
npx -y @modelcontextprotocol/server-memory

# å®é™…è¡Œä¸ºï¼š
1. æ£€æŸ¥æœ¬åœ°æ˜¯å¦å·²å®‰è£…
2. å¦‚æœæ²¡æœ‰ï¼Œè‡ªåŠ¨ä» npm ä¸‹è½½åˆ°ç¼“å­˜ (~/.npm/_npx/)
3. è¿è¡Œä¸‹è½½çš„åŒ…
```

**ç»“è®ºï¼š**npm åŒ…å±‚é¢ä¼šè‡ªåŠ¨å®‰è£…ï¼

---

### 3. ç³»ç»Ÿä¾èµ–ä¸ä¼šè‡ªåŠ¨å®‰è£…

```bash
# å³ä½¿ npx ä¸‹è½½äº† @playwright/mcp
npx -y @playwright/mcp@latest

# ä½†å¦‚æœç¼ºå°‘ç³»ç»Ÿä¾èµ–ï¼ˆå¦‚ libnss3ï¼‰ï¼ŒMCP å¯åŠ¨ä¼šå¤±è´¥
# âŒ é”™è¯¯: error while loading shared libraries: libnss3.so
```

**ç»“è®ºï¼š**ç³»ç»Ÿä¾èµ–å¿…é¡»é¢„å…ˆå®‰è£…åˆ°é•œåƒä¸­ï¼

---

### 4. Playwright æµè§ˆå™¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨ä¸‹è½½

```bash
# playwright åŒ…å®‰è£…åï¼Œæµè§ˆå™¨äºŒè¿›åˆ¶æ–‡ä»¶è¿˜éœ€è¦å•ç‹¬ä¸‹è½½
npm install -g playwright        # â† åªå®‰è£… JS ä»£ç 
npx playwright install chromium  # â† å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œï¼Œä¸‹è½½ ~170MB æµè§ˆå™¨

# å¦‚æœä¸æ‰§è¡Œç¬¬äºŒæ­¥ï¼ŒMCP å¯åŠ¨ä¼šå¤±è´¥
# âŒ é”™è¯¯: Could not find browser binary
```

**ç»“è®ºï¼š**é‡é‡çº§ä¾èµ–ï¼ˆæµè§ˆå™¨ï¼‰å¿…é¡»é¢„å…ˆå®‰è£…ï¼

---

## MCP å¯åŠ¨æ—¶åºå›¾

```
ç”¨æˆ·æ‰§è¡Œ: gabox claude
    â†“
Claude Code å¯åŠ¨
    â†“
è¯»å– ~/.claude.json ä¸­çš„ mcpServers é…ç½®
    â†“
å¯¹æ¯ä¸ª MCPï¼Œæ‰§è¡Œé…ç½®çš„å‘½ä»¤ï¼ˆå¦‚ npx -y @playwright/mcpï¼‰
    â†“
npx æ£€æŸ¥æœ¬åœ°ç¼“å­˜
    â”œâ”€ å·²å®‰è£… â†’ ç›´æ¥è¿è¡Œ
    â””â”€ æœªå®‰è£… â†’ ä» npm ä¸‹è½½ â†’ è¿è¡Œ
         â†“
    MCP è¿›ç¨‹å¯åŠ¨
         â”œâ”€ éœ€è¦ç³»ç»Ÿåº“ï¼ˆlibnss3ï¼‰â†’ å¦‚æœç¼ºå¤± â†’ âŒ å¯åŠ¨å¤±è´¥
         â”œâ”€ éœ€è¦æµè§ˆå™¨ï¼ˆchromiumï¼‰â†’ å¦‚æœç¼ºå¤± â†’ âŒ å¯åŠ¨å¤±è´¥
         â””â”€ æ‰€æœ‰ä¾èµ–æ»¡è¶³ â†’ âœ… æ­£å¸¸è¿è¡Œ
```

---

## å®é™…æµ‹è¯•è®°å½•

### æµ‹è¯• 1ï¼šæ·»åŠ  filesystem MCP

```bash
# å‘½ä»¤
docker exec gabox-test claude mcp add -s user filesystem -- npx -y @modelcontextprotocol/server-filesystem /tmp

# è¾“å‡º
Added stdio MCP server filesystem with command: npx -y @modelcontextprotocol/server-filesystem /tmp to user config
File modified: /root/.claude.json

# éªŒè¯æ˜¯å¦å®‰è£…äº†åŒ…
npm list -g --depth=0 | grep filesystem
# è¾“å‡ºï¼šï¼ˆæ— ï¼‰

# ç»“è®ºï¼šåªå†™é…ç½®ï¼Œä¸å®‰è£…åŒ…
```

### æµ‹è¯• 2ï¼šnpx é¦–æ¬¡è¿è¡Œ

```bash
# æ¸…ç©º npm ç¼“å­˜
rm -rf ~/.npm

# è¿è¡Œ MCPï¼ˆé¦–æ¬¡ï¼‰
npx -y @modelcontextprotocol/server-memory --help

# è§‚å¯Ÿåˆ°çš„è¡Œä¸ºï¼š
1. npm å¼€å§‹ä¸‹è½½åŒ…ï¼ˆè‡ªåŠ¨ï¼‰
2. ä¸‹è½½å®Œæˆåç«‹å³è¿è¡Œ
3. MCP å¯åŠ¨æˆåŠŸ

# ç»“è®ºï¼šnpx -y ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶è¿è¡Œ
```

### æµ‹è¯• 3ï¼šPlaywright MCPï¼ˆåœ¨å®Œæ•´ç‰ˆé•œåƒä¸­ï¼‰

```bash
# æ·»åŠ  Playwright MCP é…ç½®
claude mcp add -s user playwright -- npx -y @playwright/mcp@latest

# æ£€æŸ¥ playwright æ˜¯å¦å·²å®‰è£…
npm list -g --depth=0 | grep playwright
# è¾“å‡ºï¼šâ””â”€â”€ playwright@1.48.0

# æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å·²å®‰è£…
ls ~/.cache/ms-playwright/
# è¾“å‡ºï¼šchromium-1140  ffmpeg-1010

# è¿è¡Œæµ‹è¯•
npx -y @playwright/mcp@latest --help
# è¾“å‡ºï¼šUsage: Playwright MCP [options]...
# âœ… æˆåŠŸï¼å› ä¸ºå®Œæ•´ç‰ˆé•œåƒå·²é¢„è£…æ‰€æœ‰ä¾èµ–

# ç»“è®ºï¼šå®Œæ•´ç‰ˆé•œåƒå·¥ä½œæ­£å¸¸
```

### æµ‹è¯• 4ï¼šPlaywright MCPï¼ˆåœ¨åŸºç¡€ç‰ˆé•œåƒä¸­ï¼‰

```bash
# ä½¿ç”¨åŸºç¡€ç‰ˆé•œåƒï¼ˆæœªå®‰è£… playwrightï¼‰
docker run -it gabox-dev:base bash

# æ·»åŠ  Playwright MCP
claude mcp add -s user playwright -- npx -y @playwright/mcp@latest

# å¯åŠ¨ Claude Codeï¼ˆå®ƒä¼šå°è¯•å¯åŠ¨ MCPï¼‰
claude code
# MCP å¯åŠ¨è¿‡ç¨‹ï¼š
# 1. npx è‡ªåŠ¨ä¸‹è½½ @playwright/mcp âœ…
# 2. @playwright/mcp éœ€è¦ playwright åŒ… âŒ ç¼ºå¤±
#    â†’ npx å¯èƒ½è‡ªåŠ¨ä¸‹è½½ playwright âœ…
# 3. playwright éœ€è¦æµè§ˆå™¨äºŒè¿›åˆ¶ âŒ ç¼ºå¤±
#    â†’ ä¸ä¼šè‡ªåŠ¨ä¸‹è½½
# 4. playwright éœ€è¦ç³»ç»Ÿåº“ï¼ˆlibnss3ï¼‰âŒ ç¼ºå¤±
#    â†’ ä¸ä¼šè‡ªåŠ¨å®‰è£…

# ç»“æœï¼šMCP å¯åŠ¨å¤±è´¥ âŒ
```

---

## ä¾èµ–å®‰è£…å±‚æ¬¡

| ä¾èµ–ç±»å‹ | æ˜¯å¦è‡ªåŠ¨å®‰è£… | å®‰è£…æ—¶æœº | è§£å†³æ–¹æ¡ˆ |
|---------|------------|---------|---------|
| **MCP npm åŒ…**<br>ï¼ˆå¦‚ @playwright/mcpï¼‰ | âœ… æ˜¯ï¼ˆnpx -yï¼‰ | Claude Code å¯åŠ¨æ—¶ | æ— éœ€å¤„ç† |
| **npm ä¾èµ–**<br>ï¼ˆå¦‚ playwrightï¼‰ | âš ï¸ å¯èƒ½ï¼ˆå–å†³äº package.jsonï¼‰ | npx ä¸‹è½½ MCP åŒ…æ—¶ | æœ‰äº›éœ€è¦é¢„è£… |
| **æµè§ˆå™¨äºŒè¿›åˆ¶**<br>ï¼ˆå¦‚ chromiumï¼‰ | âŒ å¦ | - | å¿…é¡»åœ¨é•œåƒä¸­é¢„è£… |
| **ç³»ç»Ÿåº“**<br>ï¼ˆå¦‚ libnss3ï¼‰ | âŒ å¦ | - | å¿…é¡»åœ¨é•œåƒä¸­é¢„è£… |

---

## ä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¾èµ–ç®¡ç†æ–¹æ¡ˆï¼Ÿ

è™½ç„¶ `npx -y` ä¼šè‡ªåŠ¨ä¸‹è½½ npm åŒ…ï¼Œä½†ä»¥ä¸‹æƒ…å†µä»éœ€æ‰‹åŠ¨ç®¡ç†ï¼š

### 1. ç³»ç»Ÿä¾èµ–å¿…é¡»é¢„è£…

```yaml
# playwright.yml
dependencies:
  system:
    - libnss3      # â† ä¸ä¼šè‡ªåŠ¨å®‰è£…
    - libgbm1      # â† ä¸ä¼šè‡ªåŠ¨å®‰è£…
    - libatk1.0-0  # â† ä¸ä¼šè‡ªåŠ¨å®‰è£…
```

### 2. æµè§ˆå™¨äºŒè¿›åˆ¶éœ€è¦é¢å¤–æ­¥éª¤

```yaml
# playwright.yml
dependencies:
  post_install:
    - "npx playwright install chromium"  # â† å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œ
```

### 3. æŸäº› npm åŒ…éœ€è¦é¢„è£…ï¼ˆé¿å…é¦–æ¬¡å¯åŠ¨æ…¢ï¼‰

```yaml
# playwright.yml
dependencies:
  npm:
    - "playwright@1.48.0"  # â† é¢„è£…å¯åŠ é€Ÿé¦–æ¬¡å¯åŠ¨
```

### 4. ç¯å¢ƒå˜é‡é…ç½®

```yaml
# playwright.yml
dependencies:
  env:
    PLAYWRIGHT_DOWNLOAD_HOST: "https://npmmirror.com/mirrors/playwright/"
```

---

## ä¸¤ç§é•œåƒç­–ç•¥å¯¹æ¯”

### ç­–ç•¥ Aï¼šåŸºç¡€é•œåƒ + è¿è¡Œæ—¶ä¸‹è½½ï¼ˆå½“å‰æ–¹æ¡ˆé—®é¢˜æ‰€åœ¨ï¼‰

```dockerfile
# Dockerfileï¼ˆåŸºç¡€ç‰ˆï¼‰
FROM python:3.12-slim
RUN apt-get install nodejs npm
# ä¸å®‰è£… MCP ä¾èµ–
```

**ç”¨æˆ·ä½“éªŒï¼š**
```bash
gabox claude  # å¯åŠ¨å®¹å™¨
# åœ¨ Claude Code ä¸­æ·»åŠ  Playwright MCP
# â†’ npx å¼€å§‹ä¸‹è½½ @playwright/mcpï¼ˆ~10sï¼‰
# â†’ npx å¼€å§‹ä¸‹è½½ playwrightï¼ˆ~30sï¼‰
# â†’ playwright å°è¯•è¿è¡Œ
# â†’ âŒ é”™è¯¯: libnss3 ç¼ºå¤±
# â†’ ç”¨æˆ·å¿…é¡»æ‰‹åŠ¨å®‰è£…ç³»ç»Ÿä¾èµ–
```

âŒ **é—®é¢˜ï¼š**ç³»ç»Ÿä¾èµ–å¯¼è‡´ MCP å¯åŠ¨å¤±è´¥

---

### ç­–ç•¥ Bï¼šå®Œæ•´é•œåƒ + é¢„è£…ä¾èµ–ï¼ˆå½“å‰ Dockerfile.fullï¼‰

```dockerfile
# Dockerfile.full
FROM python:3.12-slim
RUN apt-get install -y libnss3 libgbm1 ...  # é¢„è£…ç³»ç»Ÿä¾èµ–
RUN npm install -g playwright              # é¢„è£… playwright
RUN npx playwright install chromium        # é¢„è£…æµè§ˆå™¨
```

**ç”¨æˆ·ä½“éªŒï¼š**
```bash
gabox build --full  # æ„å»ºä¸€æ¬¡ï¼ˆ~5 åˆ†é’Ÿï¼‰
gabox claude
# åœ¨ Claude Code ä¸­æ·»åŠ  Playwright MCP
# â†’ npx æ£€æµ‹åˆ° playwright å·²å®‰è£…
# â†’ playwright æ£€æµ‹åˆ° chromium å·²å®‰è£…
# â†’ ç³»ç»Ÿä¾èµ–å·²æ»¡è¶³
# â†’ âœ… MCP ç«‹å³å¯åŠ¨æˆåŠŸï¼ˆ<1sï¼‰
```

âœ… **ä¼˜ç‚¹ï¼š**å¼€ç®±å³ç”¨ï¼Œç”¨æˆ·ä½“éªŒå¥½

âŒ **ç¼ºç‚¹ï¼š**é•œåƒå¤§ï¼ˆ2.36GBï¼‰ï¼ŒåŒ…å«å¯èƒ½ç”¨ä¸åˆ°çš„ä¾èµ–

---

## ç†æƒ³æ–¹æ¡ˆï¼šæŒ‰éœ€æ„å»ºé•œåƒ

### æ–¹æ¡ˆï¼šä¾èµ–æ¸…å• + åŠ¨æ€æ„å»º

```bash
# ç”¨æˆ·æ·»åŠ  MCP
gabox mcp add playwright

# gabox çš„è¡Œä¸ºï¼š
1. æ£€æŸ¥ ~/.gabox/mcp-deps/playwright.yml
2. å‘ç°éœ€è¦ï¼šç³»ç»Ÿä¾èµ– + æµè§ˆå™¨äºŒè¿›åˆ¶
3. è¯¢é—®ç”¨æˆ·ï¼š"playwright éœ€è¦çº¦ 200MB ä¾èµ–ï¼Œæ˜¯å¦å®‰è£…ï¼Ÿ"
4. ç”¨æˆ·ç¡®è®¤åï¼š
   - åœ¨å®¹å™¨ä¸­å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆapt-get installï¼‰
   - åœ¨å®¹å™¨ä¸­ä¸‹è½½æµè§ˆå™¨ï¼ˆnpx playwright installï¼‰
   - ä¿å­˜å¿«ç…§ï¼ˆdocker commitï¼‰
5. åç»­ä½¿ç”¨è¯¥å¿«ç…§å¯åŠ¨å®¹å™¨ï¼ŒMCP ç«‹å³å¯ç”¨
```

**ä¼˜åŠ¿ï¼š**
- âœ… åŸºç¡€é•œåƒå°ï¼ˆ~500MBï¼‰
- âœ… æŒ‰éœ€å¢é•¿ï¼ˆåªè£…ç”¨æˆ·éœ€è¦çš„ï¼‰
- âœ… å¿«ç…§å¤ç”¨ï¼ˆå®‰è£…ä¸€æ¬¡ï¼Œæ°¸ä¹…å¯ç”¨ï¼‰
- âœ… å¯åˆ†äº«ï¼ˆæ¨é€å¿«ç…§åˆ°é•œåƒä»“åº“ï¼‰

---

## æœ€ç»ˆç»“è®º

### â“ é—®é¢˜ï¼š`claude mcp add` ä¼šè‡ªåŠ¨è§£å†³ä¾èµ–å—ï¼Ÿ

**ç­”æ¡ˆï¼š**éƒ¨åˆ†ä¼šï¼Œä½†ä¸å®Œå…¨

| ä¾èµ–ç±»å‹ | è‡ªåŠ¨å®‰è£… | è¯´æ˜ |
|---------|---------|------|
| MCP npm åŒ… | âœ… æ˜¯ | npx -y è‡ªåŠ¨ä¸‹è½½ |
| æ™®é€š npm ä¾èµ– | âš ï¸ éƒ¨åˆ† | å–å†³äº package.json |
| æµè§ˆå™¨äºŒè¿›åˆ¶ | âŒ å¦ | éœ€è¦æ‰‹åŠ¨ `playwright install` |
| ç³»ç»Ÿåº“ | âŒ å¦ | éœ€è¦ apt-get install |
| ç¯å¢ƒå˜é‡ | âŒ å¦ | éœ€è¦æ‰‹åŠ¨é…ç½® |

### âœ… ç»“è®ºï¼šä¾ç„¶éœ€è¦ä¾èµ–ç®¡ç†æ–¹æ¡ˆ

è™½ç„¶ npm åŒ…ä¼šè‡ªåŠ¨ä¸‹è½½ï¼Œä½†**ç³»ç»Ÿä¾èµ–å’Œæµè§ˆå™¨äºŒè¿›åˆ¶**ä¸ä¼šï¼Œè¿™äº›å¿…é¡»é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š

1. **å½“å‰æ–¹æ¡ˆ**ï¼šDockerfile.full é¢„è£…æ‰€æœ‰ä¾èµ–ï¼ˆç®€å•ä½†è‡ƒè‚¿ï¼‰
2. **æ¨èæ–¹æ¡ˆ**ï¼šä¾èµ–æ¸…å• + åŠ¨æ€å®‰è£… + å¿«ç…§ä¿å­˜ï¼ˆçµæ´»ä¸”é«˜æ•ˆï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

æ ¹æ®æµ‹è¯•ç»“æœï¼Œæˆ‘å»ºè®®ï¼š

### çŸ­æœŸï¼ˆä¿æŒç®€å•ï¼‰
âœ… ä¿ç•™ `Dockerfile.full`ï¼Œä½œä¸º"ä¸€é”®å¯ç”¨"æ–¹æ¡ˆ
âœ… åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ä¸¤ç§é•œåƒçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯

### ä¸­æœŸï¼ˆå¢å¼ºä½“éªŒï¼‰
âœ… å®ç°ä¾èµ–æ¸…å•æœºåˆ¶ï¼ˆå¦‚è®¾è®¡æ–‡æ¡£ä¸­çš„æ–¹æ¡ˆ Aï¼‰
âœ… æ”¯æŒ `gabox mcp add --auto-install` è‡ªåŠ¨å®‰è£…ä¾èµ–
âœ… æ”¯æŒ `gabox snapshot save` ä¿å­˜ç¯å¢ƒå¿«ç…§

### é•¿æœŸï¼ˆæœ€ä½³å®è·µï¼‰
âœ… å»ºç«‹ç¤¾åŒºä¾èµ–æ¸…å•ä»“åº“
âœ… å®ç°æ™ºèƒ½ä¾èµ–æ£€æµ‹
âœ… æä¾›é¢„æ„å»ºçš„ MCP æ¨¡å—é•œåƒ

---

## è¡¥å……ï¼šnpx çš„å·¥ä½œåŸç†

```bash
# npx -y @playwright/mcp@latest

# æ‰§è¡Œæµç¨‹ï¼š
1. æ£€æŸ¥ ~/.npm/_npx/ ç¼“å­˜
   â”œâ”€ å·²ç¼“å­˜ â†’ è·³åˆ°æ­¥éª¤ 4
   â””â”€ æœªç¼“å­˜ â†’ ç»§ç»­

2. ä» npm registry ä¸‹è½½åŒ…
   npm install --prefix ~/.npm/_npx/xxx @playwright/mcp@latest

3. ä¸‹è½½å®Œæˆåç¼“å­˜åˆ° ~/.npm/_npx/

4. è¿è¡ŒåŒ…ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶
   node ~/.npm/_npx/xxx/node_modules/@playwright/mcp/dist/index.js

5. MCP è¿›ç¨‹å¯åŠ¨
   â”œâ”€ æˆåŠŸ â†’ ä¸ Claude Code å»ºç«‹è¿æ¥
   â””â”€ å¤±è´¥ â†’ è¾“å‡ºé”™è¯¯æ—¥å¿—ï¼ˆç”¨æˆ·çœ‹ä¸åˆ°ï¼Œè®°å½•åœ¨ Claude æ—¥å¿—ä¸­ï¼‰
```

**å…³é”®ç‚¹ï¼š**
- npx ä¼šç¼“å­˜ä¸‹è½½çš„åŒ…ï¼ˆä¸ä¼šæ¯æ¬¡é‡æ–°ä¸‹è½½ï¼‰
- å¦‚æœåŒ…çš„ä¾èµ–åœ¨ package.json ä¸­å£°æ˜ï¼Œnpx ä¼šè‡ªåŠ¨å®‰è£…
- ä½† Playwright çš„æµè§ˆå™¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸åœ¨ package.json ä¸­ï¼Œéœ€è¦ post-install è„šæœ¬
- post-install è„šæœ¬åœ¨ npx ä¸´æ—¶å®‰è£…æ—¶ä¸ä¼šæ‰§è¡Œï¼ˆåªåœ¨ npm install -g æ—¶æ‰§è¡Œï¼‰

è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ Playwright å¿…é¡»é¢„è£…ï¼
